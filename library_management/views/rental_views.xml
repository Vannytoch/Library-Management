<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <record id="view_library_rental_form" model="ir.ui.view">
        <field name="name">library.rental.form</field>
        <field name="model">library.rental</field>
        <field name="arch" type="xml">
            <form string="Rental">
                <header>
                    <button name="action_confirm" type="object" string="Confirm" class="btn btn-primary" invisible="state != 'draft'"/>
                    <button name="action_send_mail_rental" type="object" string="Send Mail" class="btn btn-primary" invisible="state != 'overdue'"/>
                    <button name="action_start" type="object" string="Start Rental" class="btn btn-success" invisible="state != 'confirmed'"/>
                    <button name="action_return" type="object" string="Return" class="btn btn-secondary" invisible="state not in ['active', 'overdue'] "/>
                    <button name="action_mark_overdue" type="object" string="Mark Overdue" class="btn btn-danger" invisible="(due_date &gt;= is_visible_due) or (state != 'active')"/>
                    <button name="action_reset_to_draft" type="object" string="Reset to Draft" class="btn btn-warning" invisible="state in ['draft', 'returned']"/>

                    <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,active,returned,overdue"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="name" readonly="1"/>
                            <field name="member_id" readonly="state != 'draft'"/>
                            <field name="book_ids" widget="many2many_tags" readonly="state != 'draft'" domain="[('id', 'in', available_book_ids)]"/>
                            <field name="rental_fee" readonly="1" widget="monetary"/>
                        </group>
                        <group>
                            <field name="rental_date" readonly="state != 'draft'"/>
                            <field name="due_date" readonly="state != 'draft'"/>
                            <field name="return_date" readonly="1"/>
                            <field name="currency_id" invisible="1"/>

                        </group>
                    </group>
                </sheet>
                <div class="oe_chatter">
                        <field name="message_ids" widget="mail_thread"/>
                    </div>

            </form>
        </field>
    </record>

    <record id="view_library_rental_tree" model="ir.ui.view">
        <field name="name">library.rental.list.view</field>
        <field name="model">library.rental</field>
        <field name="arch" type="xml">
            <list string="Rentals" >
                <header>
                    <button name="action_create_report" type="object" string="Report" display="always"/>
                    <button name="generate_and_send_report"
        type="object"
        string="Send Monthly Report"
        class="btn-primary"/>
                </header>
                <field name="name"/>
                <field name="member_id"/>
                <field name="book_ids"/>
                <field name="rental_date"/>
                <field name="due_date"/>
                <field name="return_date" readonly="1"/>
                <field name="rental_fee" widget="monetary" width="350" sum="Total fee"/>
                <field name="state"
                       decoration-primary="state == 'confirmed'"
                       decoration-success="state == 'active'"
                       decoration-warning="state == 'draft'"
                       decoration-danger="state == 'overdue'" width="100" widget="badge"/>
                <field name="currency_id" column_invisible="1"/>
                <field name="create_date" optional="hide"/>
            </list>
        </field>
    </record>

    <record id="view_library_rental_kanban" model="ir.ui.view">
        <field name="name">library.rental.kanban</field>
        <field name="model">library.rental</field>
        <field name="arch" type="xml">
            <kanban default_group_by="state">
                <field name="state"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <strong><field name="name"/></strong><br/>
                            Book: <field name="book_ids"/><br/>
                            <span>Member: <field name="member_id"/></span><br/>
                            <span>Rental: <field name="rental_date"/></span><br/>
                            <span>Due: <field name="due_date"/></span><br/>
                            <span>Status: <field name="state"/></span>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="action_library_rental" model="ir.actions.act_window">
        <field name="name">Rentals</field>
        <field name="res_model">library.rental</field>
        <field name="view_mode">list,form,kanban</field>
    </record>

    <menuitem id="menu_library_rental_action" name="Rental Records" parent="library_book_root_menu" action="action_library_rental"/>


</odoo>

